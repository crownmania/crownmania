import{G as H,H as ze,_ as w,I as Ke,K as ue,M as He,T as $e,N as Ge,u as re,P as Ve,z as Je,v as le,i as W,e as Ye,C as Ze,t as Qe,A as S,l as Q,h as B,W as j,F as he,f as fe}from"./base.esm-47809bc2.js";import{_ as d}from"./defineProperty-0f7e3690.js";import{P as ge,T as Xe}from"./solanaProvider.esm-d76d1c5c.js";import{s as Le}from"./secp256k1-e5c7fdd6.js";import"./modal.esm-dc74f401.js";import{d as et}from"./index-e098377f.js";import{B as tt}from"./baseSolanaAdapter.esm-196858f1.js";import"./vendor-e80652ae.js";import"./bn-7ed28666.js";import"./index-d9da954e.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./index-67ac1df4.js";import"./firebase-b7a45c8e.js";function q(){}const me="SYN",X="ACK",pe="BRK";class _e extends H.Duplex{constructor(e){let{name:r,target:s,targetWindow:n=window,targetOrigin:i="*"}=e;if(super({objectMode:!0}),d(this,"_init",void 0),d(this,"_haveSyn",void 0),d(this,"_name",void 0),d(this,"_target",void 0),d(this,"_targetWindow",void 0),d(this,"_targetOrigin",void 0),d(this,"_onMessage",void 0),d(this,"_synIntervalId",void 0),!r||!s)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=r,this._target=s,this._targetWindow=n,this._targetOrigin=i,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(pe,null,q),this._haveSyn=!1,this._init=!1}_handShake(){this._write(me,null,q),this.cork()}_onData(e){if(!this._init)e===me?(this._haveSyn=!0,this._write(X,null,q)):e===X&&(this._init=!0,this._haveSyn||this._write(X,null,q),this.uncork());else if(e===pe)this._break();else try{this.push(e)}catch(r){this.emit("error",r)}}_postMessage(e){const r=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},r)}onMessage(e){const r=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof r!="object"||r.target!==this._name||!r.data||this._onData(r.data)}_read(){}_write(e,r,s){this._postMessage(e),s()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}const rt={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}},we={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}},Ee=rt.rpc.internal,st="Unspecified error message. This is a bug, please report it.",nt="Unspecified server error.";function ke(t){return Number.isInteger(t)}function ve(t){return typeof t=="string"&&t.length>0}function ye(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function it(t){return t>=-32099&&t<=-32e3}function Me(t){const e=t;return!(!e||!ke(e.code)||!ve(e.message)||e.stack&&!ve(e.stack))}function ot(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:st;if(ke(t)){const r=t.toString();if(Object.hasOwn(we,r))return we[r].message;if(it(t))return nt}return e}const at={code:Ee,message:ot(Ee)};function se(t){try{JSON.parse(JSON.stringify(t,(e,r)=>{if(e==="__proto__"||e==="constructor")throw new Error("Not valid json");if(typeof r=="function"||typeof r=="symbol")throw new Error("Not valid json");return r}),(e,r)=>{if(!(e==="__proto__"||e==="constructor"))return r})}catch{return!1}return!0}function Se(t){return Object.getOwnPropertyNames(t).reduce((e,r)=>{const s=t[r];return se(s)&&(e[r]=s),e},{})}function dt(t){return Array.isArray(t)?t.map(e=>se(e)?e:ye(e)?Se(e):null):ye(t)?Se(t):se(t)?t:null}function ct(t,e){if(t&&typeof t=="object"&&"serialize"in t&&typeof t.serialize=="function")return t.serialize();if(Me(t))return t;const r=dt(t);return w(w({},e),{},{data:{cause:r}})}function Ie(t){let{fallbackError:e=at,shouldIncludeStack:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Me(e))throw new Error("Must provide fallback error with integer number code and string message.");const s=ct(t,e);return r||delete s.stack,s}function be(t,e,r){try{Reflect.apply(t,e,r)}catch(s){setTimeout(()=>{throw s})}}function ut(t){const e=t.length,r=new Array(e);for(let s=0;s<e;s+=1)r[s]=t[s];return r}class $ extends ze.EventEmitter{emit(e){let r=e==="error";const s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];if(r){let u;if(i.length>0&&([u]=i),u instanceof Error)throw u;const a=new Error(`Unhandled error.${u?` (${u.message})`:""}`);throw a.context=u,a}const c=s[e];if(c===void 0)return!1;if(typeof c=="function")be(c,this,i);else{const u=c.length,a=ut(c);for(let h=0;h<u;h+=1)be(a[h],this,i)}return!0}}class k extends Error{constructor(e){let{code:r,message:s,data:n}=e;if(!Number.isInteger(r))throw new Error("code must be an integer");if(!s||typeof s!="string")throw new Error("message must be string");super(s),d(this,"code",void 0),d(this,"data",void 0),this.code=r,n!==void 0&&(this.data=n)}toString(){return He({code:this.code,message:this.message,data:this.data,stack:this.stack})}}const ne=function(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(s,n)=>{s||n.error?e(s||n.error):!r||Array.isArray(n)?t(n):t(n.result)}};function lt(){const t={};function e(){return!1}const r=new $;function s(u){const a=t[u.id];if(!a)throw new Error(`StreamMiddleware - Unknown response id "${u.id}"`);delete t[u.id],Object.assign(a.res,u),setTimeout(a.end)}function n(u){r.emit("notification",u)}function i(u,a,h){let f;try{!u.id?n(u):s(u)}catch(l){f=l}h(f)}const o=new H.Duplex({objectMode:!0,read:e,write:i});return{events:r,middleware:(u,a,h,f)=>{o.push(u),t[u.id]={req:u,res:a,next:h,end:f}},stream:o}}function ht(){return(t,e,r,s)=>{const n=t.id,i=Math.random().toString(36).slice(2);t.id=i,e.id=i,r(o=>{t.id=n,e.id=n,o()})}}class b extends ${constructor(){super(),d(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,r,s){const n=[];let i=null,o=!1;for(const c of s)if([i,o]=await b._runMiddleware(e,r,c,n),o)break;return[i,o,n.reverse()]}static _runMiddleware(e,r,s,n){return new Promise(i=>{const o=u=>{const a=u||r.error;a&&(typeof a=="object"&&Object.keys(a).includes("stack")===!1&&(a.stack="Stack trace is not available."),r.error=Ie(a,{shouldIncludeStack:!0,fallbackError:{message:(a==null?void 0:a.message)||(a==null?void 0:a.toString()),code:(a==null?void 0:a.code)||-32603,stack:(a==null?void 0:a.stack)||"Stack trace is not available.",data:(a==null?void 0:a.data)||(a==null?void 0:a.message)||(a==null?void 0:a.toString())}})),i([a,!0])},c=u=>{r.error?o(r.error):(u&&(typeof u!="function"&&o(new k({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),n.push(u)),i([null,!1]))};try{s(e,r,c,o)}catch(u){o(u)}})}static async _runReturnHandlers(e){for(const r of e)await new Promise((s,n)=>{r(i=>i?n(i):s())})}static _checkForCompletion(e,r,s){if(!("result"in r)&&!("error"in r))throw new k({code:-32603,message:"Response has no error or result for request"});if(!s)throw new k({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,r){if(r&&typeof r!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?r?this._handleBatch(e,r):this._handleBatch(e):r?this._handle(e,r):this._promiseHandle(e)}asMiddleware(){return async(e,r,s,n)=>{try{const[i,o,c]=await b._runAllMiddleware(e,r,this._middleware);return o?(await b._runReturnHandlers(c),n(i)):s(async u=>{try{await b._runReturnHandlers(c)}catch(a){return u(a)}return u()})}catch(i){return n(i)}}}async _handleBatch(e,r){try{const s=await Promise.all(e.map(this._promiseHandle.bind(this)));return r?r(null,s):s}catch(s){if(r)return r(s);throw s}}_promiseHandle(e){return new Promise((r,s)=>{this._handle(e,(n,i)=>{n&&i===void 0?s(n):r(i)}).catch(s)})}async _handle(e,r){if(!e||Array.isArray(e)||typeof e!="object"){const g=new k({code:-32603,message:"request must be plain object"});return r(g,{id:void 0,jsonrpc:"2.0",error:g})}if(typeof e.method!="string"){const g=new k({code:-32603,message:"method must be string"});return r(g,{id:e.id,jsonrpc:"2.0",error:g})}const s=w({},e),n={id:s.id,jsonrpc:s.jsonrpc};let i=null;try{await this._processRequest(s,n)}catch(g){i=g}if(i&&(delete n.result,!n.error)){var o,c,u,a,h,f,l;typeof i=="object"&&Object.keys(i).includes("stack")===!1&&(i.stack="Stack trace is not available."),n.error=Ie(i,{shouldIncludeStack:!0,fallbackError:{message:((o=i)===null||o===void 0?void 0:o.message)||((c=i)===null||c===void 0?void 0:c.toString()),code:((u=i)===null||u===void 0?void 0:u.code)||-32603,stack:((a=i)===null||a===void 0?void 0:a.stack)||"Stack trace is not available.",data:((h=i)===null||h===void 0?void 0:h.data)||((f=i)===null||f===void 0?void 0:f.message)||((l=i)===null||l===void 0?void 0:l.toString())}})}return r(i,n)}async _processRequest(e,r){const[s,n,i]=await b._runAllMiddleware(e,r,this._middleware);if(b._checkForCompletion(e,r,n),await b._runReturnHandlers(i),s)throw s}}class ft extends H.Duplex{constructor(e){let{parent:r,name:s}=e;super({objectMode:!0}),d(this,"_parent",void 0),d(this,"_name",void 0),this._parent=r,this._name=s}_read(){}_write(e,r,s){this._parent.push({name:this._name,data:e}),s()}}const Ce=Symbol("IGNORE_SUBSTREAM");class gt extends H.Duplex{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(w(w({},e),{},{objectMode:!0})),d(this,"_substreams",void 0),d(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const r=new ft({parent:this,name:e});return this._substreams[e]=r,mt(this,s=>r.destroy(s||void 0)),r}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Ce}_read(){}_write(e,r,s){const{name:n,data:i}=e;if(!n)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),s();const o=this._substreams[n];return o?(o!==Ce&&o.push(i),s()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${n}"`),s())}}function mt(t,e){const r=Ke(e);ue(t,{readable:!1},r),ue(t,{writable:!1},r)}function pt(t){let e=t;if(typeof e!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof e}`);return e.length%2&&(e=`0${e}`),e}BigInt(0);const ie={},oe={};for(let t=0;t<16;t++){const e=t,r=t*16,s=t.toString(16).toLowerCase();oe[s]=e,oe[s.toUpperCase()]=e,ie[s]=r,ie[s.toUpperCase()]=r}function _t(t){const e=t.length,r=new Uint8Array(e/2);for(let s=0;s<e;s+=2)r[s/2]=ie[t[s]]+oe[t[s+1]];return r}Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));for(let t=0;t<=256*256-1;t++)BigInt(t);const G=t=>{if(typeof t!="string")throw new Error(`hex argument type ${typeof t} must be of type string`);if(!/^0x[0-9a-fA-F]*$/.test(t))throw new Error(`Input must be a 0x-prefixed hexadecimal string, got ${t}`);const e=t.slice(2);return _t(e.length%2===0?e:pt(e))},wt=t=>{if(!Number.isSafeInteger(t)||t<0)throw new Error(`Received an invalid integer type: ${t}`);return`0x${t.toString(16)}`},x=t=>{const e=wt(t);return G(e)};BigInt("0xffffffffffffffff");BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");BigInt("115792089237316195423570985008687907853269984665640564039457584007913129639935");Le.CURVE.n;Le.CURVE.n/BigInt(2);BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");const Et="0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470";G(Et);const vt="0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347";G(vt);const yt="0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421";G(yt);Uint8Array.from([128]);BigInt(-1);BigInt(0);BigInt(1);BigInt(2);BigInt(3);BigInt(7);BigInt(8);BigInt(27);BigInt(28);BigInt(31);BigInt(32);BigInt(64);BigInt(128);BigInt(255);BigInt(256);BigInt(96);BigInt(100);BigInt(160);BigInt(224);BigInt(7922816251426434e13);BigInt(1461501637330903e33);BigInt(2695994666715064e52);BigInt(1e9);Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));var Ae;(function(t){t.String="string",t.Bytes="view",t.Number="number"})(Ae||(Ae={}));var Re;(function(t){t.String="string",t.Bytes="view",t.JSON="json"})(Re||(Re={}));var Te;(function(t){t[t.Number=0]="Number",t[t.BigInt=1]="BigInt",t[t.Uint8Array=2]="Uint8Array",t[t.PrefixedHexString=3]="PrefixedHexString"})(Te||(Te={}));var Pe;(function(t){t[t.Deposit=0]="Deposit",t[t.Withdrawal=1]="Withdrawal",t[t.Consolidation=2]="Consolidation"})(Pe||(Pe={}));var N;(function(t){t[t.Version=0]="Version",t[t.Balance=1]="Balance",t[t.Nonce=2]="Nonce",t[t.CodeHash=3]="CodeHash",t[t.CodeSize=4]="CodeSize"})(N||(N={}));x(N.Version);x(N.Balance);x(N.Nonce);x(N.CodeHash);x(N.CodeSize);BigInt(256)**BigInt(31);function Oe(t){let e=!1,r=0,s;try{s=window[t],e=!0,r=s.length;const n="__storage_test__";return s.setItem(n,n),s.removeItem(n),!0}catch(n){const i=n;return i&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&r!==0}}class St{constructor(){d(this,"store",new Map)}getItem(e){return this.store.get(e)||null}setItem(e,r){this.store.set(e,r)}removeItem(e){this.store.delete(e)}}class It{constructor(e,r){d(this,"storage",void 0),d(this,"_storeKey",void 0),this.storage=r,this._storeKey=e;try{r.getItem(e)||this.resetStore()}catch{}}static getInstance(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instanceMap.has(e)){let s;r==="local"&&Oe("localStorage")?s=window.localStorage:r==="session"&&Oe("sessionStorage")?s=window.sessionStorage:s=new St,this.instanceMap.set(e,new this(e,s))}return this.instanceMap.get(e)}toJSON(){return this.storage.getItem(this._storeKey)}resetStore(){const e=this.getStore();return this.storage.removeItem(this._storeKey),e}getStore(){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")}get(e){return JSON.parse(this.storage.getItem(this._storeKey)||"{}")[e]}set(e,r){const s=JSON.parse(this.storage.getItem(this._storeKey)||"{}");s[e]=r,this.storage.setItem(this._storeKey,JSON.stringify(s))}}d(It,"instanceMap",new Map);w(w({},$e),Ge);const F={IFRAME_STATUS:"iframe_status",CLOSE_WINDOW:"close_window",USER_LOGGED_IN:"user_logged_in",USER_LOGGED_OUT:"user_logged_out"},C={LOGOUT:"logout",WALLET_INSTANCE_ID:"wallet_instance_id",USER_INFO:"user_info",SET_PROVIDER:"set_provider",TOPUP:"topup",IFRAME_STATUS:"iframe_status",CLOSED_WINDOW:"closed_window",WINDOW_BLOCKED:"window_blocked",GET_PROVIDER_STATE:"get_provider_state",LOGIN_WITH_PRIVATE_KEY:"login_with_private_key",SHOW_WALLET_CONNECT:"show_wallet_connect",SHOW_CHECKOUT:"show_checkout",SHOW_WALLET_UI:"show_wallet_ui",LOGIN_WITH_SESSION_ID:"login_with_session_id"},bt={GET_PROVIDER_STATE:"wallet_get_provider_state"},ee={ACCOUNTS_CHANGED:"wallet_accounts_changed",CHAIN_CHANGED:"wallet_chain_changed",UNLOCK_STATE_CHANGED:"wallet_unlock_state_changed"};function Ct(t){return function(r,s,n){n(i=>{s.error&&re.warn(`Error in RPC response:
`,s),!r.isTorusInternal&&(re.info(`RPC (${t.origin}):`,r,"->",s),i())})}}var A={},T={};Object.defineProperty(T,"__esModule",{value:!0});T.EthereumProviderError=T.EthereumRpcError=void 0;const At=Ve;class De extends Error{constructor(e,r,s){if(!Number.isInteger(e))throw new Error('"code" must be an integer.');if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string.');super(r),this.code=e,s!==void 0&&(this.data=s)}serialize(){const e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),this.stack&&(e.stack=this.stack),e}toString(){return At.default(this.serialize(),Pt,2)}}T.EthereumRpcError=De;class Rt extends De{constructor(e,r,s){if(!Tt(e))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(e,r,s)}}T.EthereumProviderError=Rt;function Tt(t){return Number.isInteger(t)&&t>=1e3&&t<=4999}function Pt(t,e){if(e!=="[Circular]")return e}var ae={},P={};Object.defineProperty(P,"__esModule",{value:!0});P.errorValues=P.errorCodes=void 0;P.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};P.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.serializeError=t.isValidCode=t.getMessageFromCode=t.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const e=P,r=T,s=e.errorCodes.rpc.internal,n="Unspecified error message. This is a bug, please report it.",i={code:s,message:o(s)};t.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function o(l,g=n){if(Number.isInteger(l)){const E=l.toString();if(f(e.errorValues,E))return e.errorValues[E].message;if(a(l))return t.JSON_RPC_SERVER_ERROR_MESSAGE}return g}t.getMessageFromCode=o;function c(l){if(!Number.isInteger(l))return!1;const g=l.toString();return!!(e.errorValues[g]||a(l))}t.isValidCode=c;function u(l,{fallbackError:g=i,shouldIncludeStack:E=!1}={}){var O,R;if(!g||!Number.isInteger(g.code)||typeof g.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(l instanceof r.EthereumRpcError)return l.serialize();const p={};if(l&&typeof l=="object"&&!Array.isArray(l)&&f(l,"code")&&c(l.code)){const y=l;p.code=y.code,y.message&&typeof y.message=="string"?(p.message=y.message,f(y,"data")&&(p.data=y.data)):(p.message=o(p.code),p.data={originalError:h(l)})}else{p.code=g.code;const y=(O=l)===null||O===void 0?void 0:O.message;p.message=y&&typeof y=="string"?y:g.message,p.data={originalError:h(l)}}const Z=(R=l)===null||R===void 0?void 0:R.stack;return E&&l&&Z&&typeof Z=="string"&&(p.stack=Z),p}t.serializeError=u;function a(l){return l>=-32099&&l<=-32e3}function h(l){return l&&typeof l=="object"&&!Array.isArray(l)?Object.assign({},l):l}function f(l,g){return Object.prototype.hasOwnProperty.call(l,g)}})(ae);var V={};Object.defineProperty(V,"__esModule",{value:!0});V.ethErrors=void 0;const de=T,Ue=ae,_=P;V.ethErrors={rpc:{parse:t=>v(_.errorCodes.rpc.parse,t),invalidRequest:t=>v(_.errorCodes.rpc.invalidRequest,t),invalidParams:t=>v(_.errorCodes.rpc.invalidParams,t),methodNotFound:t=>v(_.errorCodes.rpc.methodNotFound,t),internal:t=>v(_.errorCodes.rpc.internal,t),server:t=>{if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:e}=t;if(!Number.isInteger(e)||e>-32005||e<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return v(e,t)},invalidInput:t=>v(_.errorCodes.rpc.invalidInput,t),resourceNotFound:t=>v(_.errorCodes.rpc.resourceNotFound,t),resourceUnavailable:t=>v(_.errorCodes.rpc.resourceUnavailable,t),transactionRejected:t=>v(_.errorCodes.rpc.transactionRejected,t),methodNotSupported:t=>v(_.errorCodes.rpc.methodNotSupported,t),limitExceeded:t=>v(_.errorCodes.rpc.limitExceeded,t)},provider:{userRejectedRequest:t=>M(_.errorCodes.provider.userRejectedRequest,t),unauthorized:t=>M(_.errorCodes.provider.unauthorized,t),unsupportedMethod:t=>M(_.errorCodes.provider.unsupportedMethod,t),disconnected:t=>M(_.errorCodes.provider.disconnected,t),chainDisconnected:t=>M(_.errorCodes.provider.chainDisconnected,t),custom:t=>{if(!t||typeof t!="object"||Array.isArray(t))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:e,message:r,data:s}=t;if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string');return new de.EthereumProviderError(e,r,s)}}};function v(t,e){const[r,s]=xe(e);return new de.EthereumRpcError(t,r||Ue.getMessageFromCode(t),s)}function M(t,e){const[r,s]=xe(e);return new de.EthereumProviderError(t,r||Ue.getMessageFromCode(t),s)}function xe(t){if(t){if(typeof t=="string")return[t];if(typeof t=="object"&&!Array.isArray(t)){const{message:e,data:r}=t;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,r]}}return[]}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageFromCode=t.serializeError=t.EthereumProviderError=t.EthereumRpcError=t.ethErrors=t.errorCodes=void 0;const e=T;Object.defineProperty(t,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(t,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});const r=ae;Object.defineProperty(t,"serializeError",{enumerable:!0,get:function(){return r.serializeError}}),Object.defineProperty(t,"getMessageFromCode",{enumerable:!0,get:function(){return r.getMessageFromCode}});const s=V;Object.defineProperty(t,"ethErrors",{enumerable:!0,get:function(){return s.ethErrors}});const n=P;Object.defineProperty(t,"errorCodes",{enumerable:!0,get:function(){return n.errorCodes}})})(A);var Ot="2.1.0";function We(t){return t!==null&&typeof t=="object"&&typeof t.pipe=="function"}function Nt(t){return We(t)&&t.writable!==!1&&typeof t._write=="function"&&typeof t._writableState=="object"}function Lt(t){return We(t)&&t.readable!==!1&&typeof t._read=="function"&&typeof t._readableState=="object"}function kt(t){return Nt(t)&&Lt(t)}var I={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",unsupportedSync:t=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${t} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:t=>`Invalid options. Received: { maxEventListeners: ${t}}`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:t=>`'args.logger' must include required method '${t}'.`},info:{connected:t=>`Torus: Connected to chain with ID "${t}".`},warnings:{}};const Mt={PRODUCTION:"production",DEVELOPMENT:"development",TESTING:"testing"},D={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},te={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless"},Dt={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}};var ce={supportedVerifierList:[te.GOOGLE,te.REDDIT,te.DISCORD],api:"https://api.tor.us",translations:Dt,prodTorusUrl:"",localStorageKeyPrefix:"torus-"},m=re.getLogger("solana-embed");function Ut(){return(t,e,r)=>{(typeof t.method!="string"||!t.method)&&(e.error=A.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:t})),r(s=>{const{error:n}=e;return n&&m.error(`Torus - RPC Error: ${n.message}`,n),s()})}}function xt(t,e,r){let s=`Torus: Lost connection to "${t}".`;e!=null&&e.stack&&(s+=`
${e.stack}`),m.warn(s),r&&r.listenerCount("error")>0&&r.emit("error",s)}const z=()=>Math.random().toString(36).slice(2),Be=async t=>{let e,r;switch(t){case"testing":e="https://solana-testing.tor.us",r="debug";break;case"development":e="http://localhost:8080",r="debug";break;default:e="https://solana.tor.us",r="error";break}return{torusUrl:e,logLevel:r}},Wt=()=>{let t=window.navigator.language||"en-US";const e=t.split("-");return t=Object.prototype.hasOwnProperty.call(ce.translations,e[0])?e[0]:"en",t},Bt={height:660,width:375},jt={height:740,width:1315},qt={height:700,width:1200},je={height:600,width:400};function Ft(t){let e;try{e=window[t];const r="__storage_test__";return e.setItem(r,r),e.removeItem(r),!0}catch(r){const s=r;return s&&(s.code===22||s.code===1014||s.name==="QuotaExceededError"||s.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}function U(t){let{width:e,height:r}=t;const s=window.screenLeft!==void 0?window.screenLeft:window.screenX,n=window.screenTop!==void 0?window.screenTop:window.screenY,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,c=1,u=Math.abs((i-e)/2/c+s),a=Math.abs((o-r)/2/c+n);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${r/c},width=${e/c},top=${a},left=${u}`}class qe extends ${constructor(e,r){let{maxEventListeners:s=100,jsonRpcStreamName:n="provider"}=r;if(super(),d(this,"isTorus",void 0),d(this,"_rpcEngine",void 0),d(this,"jsonRpcConnectionEvents",void 0),d(this,"_state",void 0),!kt(e))throw new Error(I.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(s),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.sendAsync=this.sendAsync.bind(this);const i=new gt;le(e,i,e,this._handleStreamDisconnect.bind(this,"Torus")),i.ignoreStream("phishing");const o=lt();le(o.stream,i.createStream(n),o.stream,this._handleStreamDisconnect.bind(this,"Torus RpcProvider"));const c=new b;c.push(ht()),c.push(Ut()),c.push(Ct({origin:location.origin})),c.push(o.middleware),this._rpcEngine=c,this.jsonRpcConnectionEvents=o.events}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw A.ethErrors.rpc.invalidRequest({message:I.errors.invalidRequestArgs(),data:e});const{method:r,params:s}=e;if(typeof r!="string"||r.length===0)throw A.ethErrors.rpc.invalidRequest({message:I.errors.invalidRequestMethod(),data:e});if(s!==void 0&&!Array.isArray(s)&&(typeof s!="object"||s===null))throw A.ethErrors.rpc.invalidRequest({message:I.errors.invalidRequestParams(),data:e});return new Promise((n,i)=>{this._rpcRequest({method:r,params:s},ne(n,i))})}send(e,r){this._rpcRequest(e,r)}sendAsync(e){return new Promise((r,s)=>{this._rpcRequest(e,ne(r,s))})}_handleStreamDisconnect(e,r){xt(e,r,this),this._handleDisconnect(!1,r?r.message:void 0)}}const L=t=>{const e=window.document.createElement("template"),r=t.trim();return e.innerHTML=r,e.content.firstChild};function K(t){return t.version===void 0}class Fe extends ${constructor(e){let{url:r,target:s,features:n,timeout:i=3e4}=e;super(),d(this,"url",void 0),d(this,"target",void 0),d(this,"features",void 0),d(this,"window",void 0),d(this,"windowTimer",void 0),d(this,"iClosedWindow",void 0),d(this,"timeout",void 0),this.url=r,this.target=s||"_blank",this.features=n||U(qt),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this.timeout=i,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),setTimeout(()=>{this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0},this.timeout)),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;return this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!=null&&e.focus&&this.window.focus(),Promise.resolve()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}class J extends qe{constructor(e,r){let{maxEventListeners:s=100,jsonRpcStreamName:n="provider"}=r;super(e,{maxEventListeners:s,jsonRpcStreamName:n}),d(this,"embedTranslations",void 0),d(this,"torusUrl",void 0),d(this,"dappStorageKey",void 0),d(this,"windowRefs",void 0),d(this,"tryWindowHandle",void 0),d(this,"torusAlertContainer",void 0),d(this,"torusIframe",void 0),this._state=w({},J._defaultState),this.torusUrl="",this.dappStorageKey="";const i=ce.translations[Wt()];this.embedTranslations=i.embed,this.windowRefs={},this.on("connect",()=>{this._state.isConnected=!0});const o=c=>{const{method:u,params:a}=c;if(u===F.IFRAME_STATUS){const{isFullScreen:h,rid:f}=a;this._displayIframe({isFull:h,rid:f})}else if(u==="create_window"){const{windowId:h,url:f}=a;this._createPopupBlockAlert(h,f)}else if(u===F.CLOSE_WINDOW)this._handleCloseWindow(a);else if(u===F.USER_LOGGED_IN){const{currentLoginProvider:h}=a;this._state.isLoggedIn=!0,this._state.currentLoginProvider=h}else u===F.USER_LOGGED_OUT&&(this._state.isLoggedIn=!1,this._state.currentLoginProvider=null,this._displayIframe())};this.jsonRpcConnectionEvents.on("notification",o)}get isLoggedIn(){return this._state.isLoggedIn}get isIFrameFullScreen(){return this._state.isIFrameFullScreen}isConnected(){return this._state.isConnected}async _initializeState(e){try{const{torusUrl:r,dappStorageKey:s,torusAlertContainer:n,torusIframe:i}=e;this.torusUrl=r,this.dappStorageKey=s,this.torusAlertContainer=n,this.torusIframe=i,this.torusIframe.addEventListener("load",()=>{this._state.isIFrameFullScreen||this._displayIframe()});const{currentLoginProvider:o,isLoggedIn:c}=await this.request({method:C.GET_PROVIDER_STATE,params:[]});this._handleConnect(o,c)}catch(r){m.error("Torus: Failed to get initial state. Please report this bug.",r)}finally{m.info("initialized communication state"),this._state.initialized=!0,this.emit("_initialized")}}_handleWindow(e){let{url:r,target:s,features:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new URL(r||`${this.torusUrl}/redirect?windowId=${e}`);this.dappStorageKey&&(i.hash?i.hash+=`&dappStorageKey=${this.dappStorageKey}`:i.hash=`#dappStorageKey=${this.dappStorageKey}`);const o=new Fe({url:i,target:s,features:n});if(o.open(),!o.window){this._createPopupBlockAlert(e,i.href);return}this.windowRefs[e]=o,this.request({method:"opened_window",params:{windowId:e}}),o.once("close",()=>{delete this.windowRefs[e],this.request({method:C.CLOSED_WINDOW,params:{windowId:e}})})}_displayIframe(){let{isFull:e=!1,rid:r=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={};if(e)s.display="block",s.width="100%",s.height="100%",s.top="0px",s.right="0px",s.left="0px",s.bottom="0px";else switch(s.display=this._state.torusWidgetVisibility?"block":"none",s.height="70px",s.width="70px",this._state.buttonPosition){case D.TOP_LEFT:s.top="0px",s.left="0px",s.right="auto",s.bottom="auto";break;case D.TOP_RIGHT:s.top="0px",s.right="0px",s.left="auto",s.bottom="auto";break;case D.BOTTOM_RIGHT:s.bottom="0px",s.right="0px",s.top="auto",s.left="auto";break;case D.BOTTOM_LEFT:default:s.bottom="0px",s.left="0px",s.top="auto",s.right="auto";break}Object.assign(this.torusIframe.style,s),this._state.isIFrameFullScreen=e,this.request({method:C.IFRAME_STATUS,params:{isIFrameFullScreen:e,rid:r}})}hideTorusButton(){this._state.torusWidgetVisibility=!1,this._displayIframe()}showTorusButton(){this._state.torusWidgetVisibility=!0,this._displayIframe()}_rpcRequest(e,r){const s=r,n=e;Array.isArray(n)||n.jsonrpc||(n.jsonrpc="2.0"),this.tryWindowHandle(n,s)}_handleConnect(e,r){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{currentLoginProvider:e,isLoggedIn:r}),m.debug(I.info.connected(e)))}_handleDisconnect(e,r){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let s;e?(s=new A.EthereumRpcError(1013,r||I.errors.disconnected()),m.debug(s)):(s=new A.EthereumRpcError(1011,r||I.errors.permanentlyDisconnected()),m.error(s),this._state.currentLoginProvider=null,this._state.isLoggedIn=!1,this._state.torusWidgetVisibility=!1,this._state.isIFrameFullScreen=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",s)}}_handleCloseWindow(e){const{windowId:r}=e;this.windowRefs[r]&&(this.windowRefs[r].close(),delete this.windowRefs[r])}async _createPopupBlockAlert(e,r){const s=this.getLogoUrl(),n=L(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${s}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),i=L(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),o=L('<div id="torusAlert__btn-container"></div>');o.appendChild(i),n.appendChild(o);const c=()=>{i.addEventListener("click",()=>{this._handleWindow(e,{url:r,target:"_blank",features:U(je)}),n.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})};(()=>{this.torusAlertContainer.appendChild(n)})(),c(),this.torusAlertContainer.style.display="block"}getLogoUrl(){return`${this.torusUrl}/images/torus_icon-blue.svg`}}d(J,"_defaultState",{buttonPosition:"bottom-left",currentLoginProvider:null,isIFrameFullScreen:!1,hasEmittedConnection:!1,torusWidgetVisibility:!1,initialized:!1,isLoggedIn:!1,isPermanentlyDisconnected:!1,isConnected:!1});class Y extends qe{constructor(e,r){let{maxEventListeners:s=100,jsonRpcStreamName:n="provider"}=r;super(e,{maxEventListeners:s,jsonRpcStreamName:n}),d(this,"chainId",void 0),d(this,"selectedAddress",void 0),d(this,"tryWindowHandle",void 0),this._state=w({},Y._defaultState),this.selectedAddress=null,this.chainId=null,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this.on("connect",()=>{this._state.isConnected=!0});const i=o=>{const{method:c,params:u}=o;c===ee.ACCOUNTS_CHANGED?this._handleAccountsChanged(u):c===ee.UNLOCK_STATE_CHANGED?this._handleUnlockStateChanged(u):c===ee.CHAIN_CHANGED&&this._handleChainChanged(u)};this.jsonRpcConnectionEvents.on("notification",i)}isConnected(){return this._state.isConnected}async _initializeState(){try{const{accounts:e,chainId:r,isUnlocked:s}=await this.request({method:bt.GET_PROVIDER_STATE,params:[]});this.emit("connect",{chainId:r}),this._handleChainChanged({chainId:r}),this._handleUnlockStateChanged({accounts:e,isUnlocked:s}),this._handleAccountsChanged(e)}catch(e){m.error("Torus: Failed to get initial state. Please report this bug.",e)}finally{m.info("initialized provider state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=r;const i=e;if(!Array.isArray(i)){if(i.jsonrpc||(i.jsonrpc="2.0"),i.method==="solana_accounts"||i.method==="solana_requestAccounts")n=(o,c)=>{this._handleAccountsChanged(c.result||[],i.method==="solana_accounts",s),r(o,c)};else if(i.method==="wallet_getProviderState"){this._rpcEngine.handle(e,n);return}}this.tryWindowHandle(i,n)}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),m.debug(I.info.connected(e)))}_handleDisconnect(e,r){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let s;e?(s=new A.EthereumRpcError(1013,r||I.errors.disconnected()),m.debug(s)):(s=new A.EthereumRpcError(1011,r||I.errors.permanentlyDisconnected()),m.error(s),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",s)}}_handleAccountsChanged(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e;Array.isArray(n)||(m.error("Torus: Received non-array accounts parameter. Please report this bug.",n),n=[]);for(const i of e)if(typeof i!="string"){m.error("Torus: Received non-string account. Please report this bug.",e),n=[];break}et(this._state.accounts,n)||(r&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!s&&m.error('Torus: "solana_accounts" unexpectedly updated accounts. Please report this bug.',n),this._state.accounts=n,this.emit("accountsChanged",n)),this.selectedAddress!==n[0]&&(this.selectedAddress=n[0]||null)}_handleChainChanged(){let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!e){m.error("Torus: Received invalid network parameters. Please report this bug.",{chainId:e});return}e==="loading"?this._handleDisconnect(!0):(this._handleConnect(e),e!==this.chainId&&(this.chainId=e,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:e,isUnlocked:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof r!="boolean"){m.error("Torus: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:r});return}r!==this._state.isUnlocked&&(this._state.isUnlocked=r,this._handleAccountsChanged(e||[]))}}d(Y,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});function Ne(t){return new Promise((e,r)=>{try{const s=document.createElement("img");s.onload=()=>e(!0),s.onerror=()=>e(!1),s.src=t}catch(s){r(s)}})}const zt=t=>{const{document:e}=t,r=e.querySelector('head > meta[property="og:site_name"]');if(r)return r.content;const s=e.querySelector('head > meta[name="title"]');return s?s.content:e.title&&e.title.length>0?e.title:t.location.hostname};async function Kt(t){try{const{document:e}=t;let r=e.querySelector('head > link[rel="shortcut icon"]');return r&&await Ne(r.href)||(r=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(s=>!!s.href),r&&await Ne(r.href))?r.href:""}catch{return""}}const Ht=async()=>({name:zt(window),icon:await Kt(window)}),$t=["send_transaction","sign_transaction","sign_all_transactions","sign_message","connect"],Gt=[C.SET_PROVIDER],Vt=Ft("localStorage");(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{torusUrl:r}=await Be("production");e.href=`${r}/frame`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){m.warn(e)}})();class Jt{constructor(){let{modalZIndex:e=99999}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d(this,"isInitialized",void 0),d(this,"torusAlert",void 0),d(this,"modalZIndex",void 0),d(this,"alertZIndex",void 0),d(this,"requestedLoginProvider",void 0),d(this,"provider",void 0),d(this,"communicationProvider",void 0),d(this,"dappStorageKey",void 0),d(this,"isTopupHidden",!1),d(this,"torusAlertContainer",void 0),d(this,"torusUrl",void 0),d(this,"torusIframe",void 0),d(this,"styleLink",void 0),this.torusUrl="",this.isInitialized=!1,this.requestedLoginProvider=null,this.modalZIndex=e,this.alertZIndex=e+1e3,this.dappStorageKey=""}get isLoggedIn(){return this.communicationProvider?this.communicationProvider.isLoggedIn:!1}async init(){let{buildEnv:e=Mt.PRODUCTION,enableLogging:r=!1,network:s,showTorusButton:n=!1,useLocalStorage:i=!1,buttonPosition:o=D.BOTTOM_LEFT,apiKey:c="torus-default",extraParams:u={},whiteLabel:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");Je(c);const{torusUrl:h,logLevel:f}=await Be(e);m.enableAll(),m.info(h,"url loaded"),m.info(`Solana Embed Version :${Ot}`),this.torusUrl=h,m.setDefaultLevel(f),r?m.enableAll():m.disableAll();const l=this.handleDappStorageKey(i),g=new URL(h);g.pathname.endsWith("/")?g.pathname+="frame":g.pathname+="/frame";const E=new URLSearchParams;return l&&E.append("dappStorageKey",l),E.append("origin",window.location.origin),g.hash=E.toString(),this.torusIframe=L(`<iframe
        id="torusIframe"
        class="torusIframe"
        src="${g.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex.toString()}"
      ></iframe>`),this.torusAlertContainer=L(`<div id="torusAlertContainer" style="display:none; z-index: ${this.alertZIndex.toString()}"></div>`),this.styleLink=L(`<link href="${h}/css/widget.css" rel="stylesheet" type="text/css">`),new Promise((O,R)=>{try{this.torusIframe.addEventListener("load",async()=>{const p=await Ht();this.torusIframe.contentWindow.postMessage({buttonPosition:o,apiKey:c,network:s,dappMetadata:p,extraParams:u,whiteLabel:a},g.origin),await this._setupWeb3({torusUrl:h}),n&&this.showTorusButton(),a!=null&&a.topupHide?this.isTopupHidden=a.topupHide:this.hideTorusButton(),this.isInitialized=!0,window.torus=this,O()}),window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer)}catch(p){R(p)}})}async login(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");try{this.requestedLoginProvider=e.loginProvider||null,this.requestedLoginProvider||this.communicationProvider._displayIframe({isFull:!0});const r=await new Promise((s,n)=>{this.provider._rpcRequest({method:"solana_requestAccounts",params:[this.requestedLoginProvider,e.login_hint]},ne(s,n))});if(Array.isArray(r)&&r.length>0)return r;throw new Error("Login failed")}catch(r){throw m.error("login failed",r),r}finally{this.communicationProvider.isIFrameFullScreen&&this.communicationProvider._displayIframe()}}async loginWithPrivateKey(e){if(!this.isInitialized)throw new Error("Call init() first");const{privateKey:r,userInfo:s}=e,{success:n}=await this.communicationProvider.request({method:"login_with_private_key",params:{privateKey:r,userInfo:s}});if(!n)throw new Error("Login Failed")}async logout(){if(!this.communicationProvider.isLoggedIn)throw new Error("Not logged in");await this.communicationProvider.request({method:C.LOGOUT,params:[]}),this.requestedLoginProvider=null}async cleanUp(){this.communicationProvider.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(r){return r instanceof Element||r instanceof Document}e(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),e(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),e(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.communicationProvider.hideTorusButton()}showTorusButton(){this.communicationProvider.showTorusButton()}async setProvider(e){await this.communicationProvider.request({method:C.SET_PROVIDER,params:w({},e)})}async showWallet(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=await this.communicationProvider.request({method:C.WALLET_INSTANCE_ID,params:[]}),n=e?`/${e}`:"",i=new URL(`${this.torusUrl}/wallet${n}`);i.searchParams.append("instanceId",s),Object.keys(r).forEach(c=>{i.searchParams.append(c,r[c])}),this.dappStorageKey&&(i.hash=`#dappStorageKey=${this.dappStorageKey}`),new Fe({url:i,features:U(jt)}).open()}async getUserInfo(){return await this.communicationProvider.request({method:C.USER_INFO,params:[]})}async initiateTopup(e,r){if(!this.isInitialized)throw new Error("Torus is not initialized");const s=z();return this.communicationProvider._handleWindow(s),await this.communicationProvider.request({method:C.TOPUP,params:{provider:e,params:r,windowId:s}})}async getAccounts(){return await this.provider.request({method:"getAccounts",params:[]})}async sendTransaction(e){const r=K(e),s=r?e.serialize({requireAllSignatures:!1}).toString("hex"):Buffer.from(e.serialize()).toString("hex");return await this.provider.request({method:"send_transaction",params:{message:s,isLegacyTransaction:r}})}async signAndSendTransaction(e,r){const s=K(e),n=s?e.serialize({requireAllSignatures:!1}).toString("hex"):Buffer.from(e.serialize()).toString("hex");return{signature:await this.provider.request({method:"send_transaction",params:{message:n,options:r,isLegacyTransaction:s}})}}async signTransaction(e){const r=K(e),s=r?e.serializeMessage().toString("hex"):Buffer.from(e.message.serialize()).toString("hex"),n=await this.provider.request({method:"sign_transaction",params:{message:s,messageOnly:!0,isLegacyTransaction:r}}),i=JSON.parse(n),o={publicKey:new ge(i.publicKey),signature:Buffer.from(i.signature,"hex")};return e.addSignature(o.publicKey,o.signature),e}async signAllTransactions(e){let r;const s=e.map(o=>(r=K(o),r?o.serializeMessage().toString("hex"):Buffer.from(o.message.serialize()).toString("hex"))),i=(await this.provider.request({method:"sign_all_transactions",params:{message:s,messageOnly:!0,isLegacyTransaction:r}})).map(o=>{const c=JSON.parse(o);return{publicKey:new ge(c.publicKey),signature:Buffer.from(c.signature,"hex")}});return e.forEach((o,c)=>(o.addSignature(i[c].publicKey,i[c].signature),o)),e}async signMessage(e){return await this.provider.request({method:"sign_message",params:{data:e}})}async getGaslessPublicKey(){return await this.provider.request({method:"get_gasless_public_key",params:[]})}handleDappStorageKey(e){const r=`${ce.localStorageKeyPrefix}${window.location.hostname}`;let s="";if(Vt&&e){const n=window.localStorage.getItem(r);if(n)s=n;else{const i=`torus-app-${z()}`;window.localStorage.setItem(r,i),s=i}}return this.dappStorageKey=s,s}async _setupWeb3(e){m.info("setupWeb3 running");const r=new _e({name:"embed_torus",target:"iframe_torus",targetWindow:this.torusIframe.contentWindow}),s=new _e({name:"embed_communication",target:"iframe_communication",targetWindow:this.torusIframe.contentWindow}),n=new Y(r,{}),i=new J(s,{});n.tryWindowHandle=(a,h)=>{const f=a;if(!Array.isArray(f)&&$t.includes(f.method)){if(!this.communicationProvider.isLoggedIn)throw new Error("User Not Logged In");const l=z();i._handleWindow(l,{target:"_blank",features:U(je)}),f.windowId=l}n._rpcEngine.handle(f,h)},i.tryWindowHandle=(a,h)=>{const f=a;if(!Array.isArray(f)&&Gt.includes(f.method)){const l=z();i._handleWindow(l,{target:"_blank",features:U(Bt)}),f.params.windowId=l}i._rpcEngine.handle(f,h)};const o=a=>{const h=n[a],f=this;n[a]=function(g,E){const{method:O,params:R=[]}=g;if(O==="solana_requestAccounts"){if(!E)return f.login({loginProvider:R[0]});f.login({loginProvider:R[0]}).then(p=>E(null,p)).catch(p=>E(p))}return h.apply(this,[g,E])}};o("request"),o("sendAsync"),o("send");const c=new Proxy(n,{deleteProperty:()=>!0}),u=new Proxy(i,{deleteProperty:()=>!0});this.provider=c,this.communicationProvider=u,await Promise.all([n._initializeState(),i._initializeState(w(w({},e),{},{dappStorageKey:this.dappStorageKey,torusAlertContainer:this.torusAlertContainer,torusIframe:this.torusIframe}))]),m.debug("Torus - injected provider")}}class cr extends tt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(e),d(this,"name",W.TORUS_SOLANA),d(this,"adapterNamespace",Ye.SOLANA),d(this,"currentChainNamespace",Ze.SOLANA),d(this,"type",Qe.EXTERNAL),d(this,"status",S.NOT_READY),d(this,"torusInstance",null),d(this,"torusWalletOptions",void 0),d(this,"initParams",void 0),d(this,"loginSettings",{}),d(this,"solanaProvider",null),this.torusWalletOptions=e.adapterSettings||{},this.initParams=e.initParams||{},this.loginSettings=e.loginSettings||{}}get provider(){return this.status!==S.NOT_READY&&this.solanaProvider?this.solanaProvider:null}set provider(e){throw new Error("Not implemented")}async init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};await super.init(e),super.checkInitializationRequirements();const{chainId:r,blockExplorer:s,displayName:n,rpcTarget:i,ticker:o,tickerName:c}=this.chainConfig,u={chainId:r,rpcTarget:i,blockExplorerUrl:s,displayName:n,tickerName:c,ticker:o,logo:""};this.torusInstance=new Jt(this.torusWalletOptions),Q.debug("initializing torus solana adapter init"),await this.torusInstance.init(w(w({showTorusButton:!1},this.initParams),{},{network:u})),this.solanaProvider=new Xe({config:{chainConfig:this.chainConfig}}),this.status=S.READY,this.emit(B.READY,W.TORUS_SOLANA);try{Q.debug("initializing torus solana adapter"),e.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(a){Q.error("Failed to connect with cached torus solana provider",a),this.emit(B.ERRORED,a)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw j.notReady("Torus wallet is not initialized");if(!this.solanaProvider)throw j.notReady("Torus wallet is not initialized");this.status=S.CONNECTING,this.emit(B.CONNECTING,{adapter:W.TORUS_SOLANA});try{await this.torusInstance.login(this.loginSettings);try{const e=this.torusInstance.provider;e.sendTransaction=this.torusInstance.sendTransaction.bind(this.torusInstance),e.signAllTransactions=this.torusInstance.signAllTransactions.bind(this.torusInstance),e.signMessage=this.torusInstance.signMessage.bind(this.torusInstance),e.signTransaction=this.torusInstance.signTransaction.bind(this.torusInstance),await this.solanaProvider.setupProvider(e)}catch(e){if(e instanceof he&&e.code===5010){const{chainId:r,blockExplorer:s,displayName:n,rpcTarget:i,ticker:o,tickerName:c}=this.chainConfig,u={chainId:r,rpcTarget:i,blockExplorerUrl:s,displayName:n,tickerName:c,ticker:o,logo:""};await this.torusInstance.setProvider(u)}else throw e}return this.status=S.CONNECTED,this.torusInstance.showTorusButton(),this.emit(S.CONNECTED,{adapter:W.TORUS_SOLANA,reconnected:this.rehydrated}),this.provider}catch(e){throw this.status=S.READY,this.rehydrated=!1,this.emit(B.ERRORED,e),e instanceof he?e:fe.connectionError("Failed to login with torus solana wallet")}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(await super.disconnectSession(),!this.torusInstance)throw j.notReady("Torus wallet is not initialized");await this.torusInstance.logout(),e.cleanup?(this.status=S.NOT_READY,this.torusInstance=null,this.solanaProvider=null):this.status=S.READY,await super.disconnect()}async getUserInfo(){if(this.status!==S.CONNECTED)throw fe.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw j.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo()}async addChain(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkAddChainRequirements(e,r),this.addChainConfig(e)}async switchChain(e){var r;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.checkSwitchChainRequirements(e,s);const n=this.getChainConfig(e.chainId);await((r=this.torusInstance)===null||r===void 0?void 0:r.setProvider({rpcTarget:n.rpcTarget,chainId:n.chainId,displayName:n.displayName,blockExplorerUrl:n.blockExplorer,ticker:n.ticker,tickerName:n.tickerName,logo:"https://images.web3auth.io/login-torus-solana.svg"})),this.setAdapterSettings({chainConfig:this.getChainConfig(e.chainId)})}}export{cr as SolanaWalletAdapter};
